function import_vector_as_trigger(tWT)
% Import a Matlab variable as a trigger channel
%
% PURPOSE:
% WT by default supports two trigger channels, which are typically read
% directly from selected pixels in the video frames. This scripts allows
% you to import an existing Matlab variable as a trigger channel. The
% Matlab variable must be defined as a global variable, you need to provide
% its name and the framerate (Hz) at which is was recorded.
%
% This script assumes that the loaded vector and the video started at the
% same time.
%
% The vector will be loaded as trigger channel A.
%

global g_tWT % load global parameter

if strcmp(g_tWT.BatchMode)
persistent sVarName nThisFs nThresh
if isempty(sVarName), sVarName = ''; end
if isempty(nThisFs), nThisFs = 40000; end
if isempty(nThresh), nThresh = 2; end

cAns = inputdlg({'Variable name (must be global)', 'Sample rate of vector (Hz)', 'Threshold'}, ...
    'Import trigger', 1, {sVarName num2str(nThisFs) num2str(nThresh)});
if isempty(cAns) return, end
sVarName = cAns{1};
nThisFs = str2num(cAns{2});
nThresh = str2num(cAns{3});

% Load global variable into variable vThisTrig
eval(sprintf('global %s;vThisTrig=%s;', sVarName, sVarName))

% Movie framerate
nFs = g_tWT.MovieInfo.FramesPerSecond;

% Resample imported variable to video frame rate
vNewTrig = decimate(vThisTrig, nThisFs/nFs);

% Threshold trigger
vThreshTrig = zeros(size(vNewTrig));
vThreshTrig(vNewTrig >= nThresh) = 1;

% Assign to Trigger A
g_tWT.MovieInfo.StimulusA = vThreshTrig;

return
